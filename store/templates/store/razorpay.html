<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<button id="pay-btn">Pay Now</button>

<script>
var options = {
  "key": "{{ razorpay_key }}",
  "amount": "{{ amount|floatformat:0 }}00",
  "currency": "INR",
  "order_id": "{{ order_id }}",

  "handler": function (response) {

    fetch("/api/payment/verify/", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "X-CSRFToken": "{{ csrf_token }}"
      },
      body: JSON.stringify({
        razorpay_payment_id: response.razorpay_payment_id,
        razorpay_order_id: response.razorpay_order_id,
        razorpay_signature: response.razorpay_signature
      })
    })
    .then(res => res.json())
    .then(data => {
      if (data.success) {
        // âœ… THIS IS THE FIX
        window.location.href = data.redirect_url;
      } else {
        alert("Payment verification failed");
      }
    })
    .catch(err => {
      console.error(err);
      alert("Something went wrong");
    });
  }
};

var rzp = new Razorpay(options);
document.getElementById("pay-btn").onclick = function(e){
  rzp.open();
  e.preventDefault();
}
</script>
